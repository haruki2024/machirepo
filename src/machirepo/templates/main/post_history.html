{% extends 'top_base.html' %}

{% block title %}投稿履歴 - まちレポ{% endblock %}



{% block content %}
<div class="app-container">
    <header class="app-header">
        <a href="{% url 'user_home' %}" class="header-link" style="font-weight: 600; color: #10b981;">&lt; 戻る</a>
        <h2 style="font-size: 1.25rem; font-weight: 700; position: absolute; left: 50%; transform: translateX(-50%);">投稿履歴</h2>
        <span style="width: 50px;"></span>
    </header>
    
    <main class="main-content p-4">
        {% if posts %}
            {% for post in posts %}
            <div class="history-item">
                <div class="history-item-header">
                    <div "w-2/3 min-w-0 pr-4">
                        <p class="history-item-title">{{ post.title|default:"タイトルなし" }}</p>
                        <p class="history-item-date">{{ post.posted_at|date:"Y/m/d" }}</p>
                    </div>
                    
                    <div class="status-wrapper">
                        
                        {# ステータスバッジ: get_status_display()で日本語の表示名を取得 #}
                        <span class="status-badge 
                                {% if post.status == 'new' %}status-new
                                {% elif post.status == 'in_progress' %}status-pending
                                {% elif post.status == 'completed' %}status-complete
                                {% elif post.status == 'not_required' %}status-not-applicable
                                {% endif %}">
                            {{ post.get_status_display }}
                        </span>

                        {# 優先度バッジ (優先度が'not'ではない場合のみ表示) #}
                        
                        {% if post.priority %}
                            <span class="priority-badge priority-{{ post.priority }}">
                                {{ post.get_priority_display }}
                            </span>
                        {% else %}
                            <span class="priority-badge priority-none">--</span>
                        {% endif %}

                    </div>
                </div>
                
                {# 管理者コメントの表示 (対応完了または対応不可の場合、かつコメントが存在する場合) #}
                {% if post.admin_note %}
                    <div class="admin-comment">
                        <p class="comment-title">管理者からのコメント</p>
                        <p class="comment-body">{{ post.admin_note | linebreaks}}</p>
                    </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="text-center p-8 bg-white rounded-lg shadow-sm border border-gray-200">
                <p class="text-gray-500">まだ投稿履歴はありません。</p>
                <a href="{% url 'photo_post_create' %}" class="mt-4 inline-block text-indigo-600 hover:text-indigo-700 font-semibold border-b border-indigo-600">
                    最初の投稿をする
                </a>
            </div>
        {% endif %}
    </main>
</div>
{% endblock %}