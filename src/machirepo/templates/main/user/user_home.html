{% extends 'top_base.html' %} 

{% block title %}住民トップページ{% endblock %} 

{% block content %}

    <main class="main-content card-layout-main">
        
        <div class="home-welcome-container">
            <div class="home-welcome-message">
                <h2>ようこそ</h2>
                <p>まちの不具合を投稿しよう</p>
            </div>
            <img src="/media/images/koemy_welcome.png" alt="コエミィ" style="width: 150px; height: auto; margin-bottom: 0.5rem;">
        </div>
        
        <div class="post-feed-container">
            <div class="post-feed-header">
                <h3 class="post-feed-title">みんなの投稿</h3>
                <a href="{% url 'post_list' %}" class="post-feed-all-link">すべて見る &gt;</a>
            </div>
            {% if latest_posts %}
                <div class="post-feed-list">
                    {% for post in latest_posts %}
                        <a href="{% url 'post_detail' post.id %}" class="history-item post-feed-item">
                            <div class="history-item-header">
                                <div>
                                    <p class="history-item-title">{{ post.title|default:"タイトルなし" }}</p>
                                    <span class="history-item-date">{{ post.posted_at|date:"Y/m/d H:i" }}</span>
                                </div>
                                <div class="status-wrapper">
                                    
                                    {# ステータスバッジ: get_status_display()で日本語の表示名を取得 #}
                                    <span class="status-badge 
                                            {% if post.status == 'new' %}status-new
                                            {% elif post.status == 'in_progress' %}status-pending
                                            {% elif post.status == 'completed' %}status-complete
                                            {% elif post.status == 'not_required' %}status-not-applicable
                                            {% endif %}">
                                        {{ post.get_status_display }}
                                    </span>
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <div style="text-align: center; padding: 4rem; background-color: #f9fafb; border-radius: 8px; margin-top: 2rem;">
                    <p style="color: #6b7280;">現在、新しい報告はありません。</p>
                </div>
            {% endif %}
        
        </div>

        <div class="home-button-container">
            <a href="{% url 'photo_post_create' %}" class="btn btn-primary btn-with-icon"> 
                <img src="/media/images/pencil-icon.png" alt="ペンアイコン" class="btn-icon"> 
                新規投稿
            </a>
        </div>

    </main>

{% endblock %}